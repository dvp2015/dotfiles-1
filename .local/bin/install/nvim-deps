#!/bin/bash

sudo apt install python3-pip
pip install -U pynvim
pip install 'python-lsp-server[all]' pylsp-mypy pyls-isort

# Install the recent Node.js in user environment
# TODO move to a separate script
# Ref: https://johnpapa.net/node-and-npm-without-sudo/
. ~/.bash-functions.rc
install_node() {
  node_version="18.15.0"
  target="node-v$node_version"
  [[ -d "$HOME/tools/$target" ]] && die "Directory already exists $HOME/tools/$target"
  folder="$target-linux-x64"
  archive="$folder.tar.xz"

  pushd $HOME/Downloads > /dev/null
  [[ -f $archive ]] || wget "https://nodejs.org/dist/v$node_version/$archive"
  mkdir -p $HOME/tools
  # extract node to a custom directory, the directory should exist.
  tar xvf "${archive}" --directory=$HOME/tools
  popd > /dev/null
  mv "$HOME/tools/${folder}" "$HOME/tools/${target}"
  # assuming ~/bin/select-node is installed
  [[ command -v select-node ]] && select-node "$target"
  npm install -g vim-language-server
}

install_node "$@"
