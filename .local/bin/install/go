#!/usr/bin/env bash
. $HOME/.bash-functions.rc

# set -eux

add_go_path() {
cat <<'END'
export GOPATH=$HOME/.go
export PATH="$PATH:/usr/local/go/bin:$GOPATH/bin"
END
}

install_go() {
    local go_version=1.18
    local go_base_name=go${go_version}
    local go_file_name=${go_base_name}.linux-amd64.tar.gz
    local go_url="https://golang.org/dl/${go_file_name}"
    local working_dir="$HOME/Downloads/install/go/$go_version"
    echo "Installing go $go_version"
    mkdir -p  $working_dir
    pushd $working_dir
    if [[ ! -d go ]]; then
        if [[ ! -r $go_file_name ]]; then
            wget $go_url
        fi
        tar -xzvf $go_file_name
    fi
    sudo mv go /usr/local
    grep GOPATH "$HOME/.profile" || add_go_path >> $HOME/.profile
    popd
}

#
# Jump: https://github.com/gsamokovarov/jump
# Lazy Git: https://github.com/jesseduffield/lazygit
# Run github actions locally with act: https://github.com/nektos/act
#

packages=(
    gsamokovarov/jump
    jesseduffield/lazygit
    nektos/act
)

install_packages() {
    for t in ${packages[@]}; do
        echo "Installing Go package $t"
        go install "github.com/$t@latest"
    done
}

main() {
    check_go && echo "Go is already installed in $(command -v go)" || install_go
    install_packages
}

is_main && main "$@"

