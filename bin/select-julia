#!/bin/bash

. ~/.bash-functions.rc

# set -eax

usage() {
    cat <<MSG
Set link to a julia executable.

Usage:

    select-julia [version]

Parameter "version" is a subfolder name in folder /opt 
with the julia instance of the desired version.
If not specified selects the most recent version.
MSG
    exit 0
}

find-julia-versions() {
    pushd /opt > /dev/null
    ls -1 -d julia* | sort
    popd  > /dev/null
}



main() {


    ([ "$1" == "-h" ] || [ "$1" == "--help" ]) && usage

    local version="$1"

    if [[ -z "$version" ]]; then
        versions=($(find-julia-versions)) 
        [[ 0 < ${#versions} ]] || die "No julia subfolders found in /opt folder"
        version="${versions[-1]}"
    fi

    if [[ ! -x "/opt/$version/bin/julia" ]]; then
        echo
        echo "Available versions:"
        find-julia-versions
        echo
        die "/opt/$version is not a valid julia folder"
    fi

    rm ~/bin/julia && ln -s /opt/$version/bin/julia ~/bin/julia && success "julia -> $(~/bin/julia --version)"

}

main "${@}"
