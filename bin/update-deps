#!/bin/bash

# Update dependencies in projects.
#
# dvp 2023-03-26
#
#

. $HOME/.bash-functions.rc

# set -exa

main() {
  local projects="$@"
  if [[ 0 == "$#" ]]; then 
      projects=(
      mckit-nuclides
      xpypact
      mapstp
      mckit-meshes
      mckit
      r2s-rfda
    )
  fi
  pushd $HOME/dev  > /dev/null
  for p in "${projects[@]}"; do
    echo "---------------------------"
    echo "Updating $p"
    pushd "$p" > /dev/null
    eval "$(pyenv init -)"
    poetry config --local virtualenvs.create false
    pyenv shell "$(select_first_local_pyenv)"
    git pull 
    poetry update 
    git commit -am "dependencies: poetry update" 
    git push 
    pyenv shell --unset
    popd > /dev/null
    echo "==========================="
  done
  popd > /dev/null
  success "Projects are updated"
}

main "$@"
